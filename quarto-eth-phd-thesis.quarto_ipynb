{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: Quarto PhD thesis template for ETH Zurich\n",
        "execute:\n",
        "  eval: false\n",
        "toc: true\n",
        "---\n",
        "\n",
        "\n",
        "This is an webpage version of the README for my Quarto ETH PhD thesis template, available on Github here: <https://github.com/blenback/quarto-eth-phd-thesis>.\\\n",
        "\\\n",
        "The template is intended to meet the [requirements](https://ethz.ch/students/en/doctorate/doctoral-thesis-examination.html) for cumulative paper PhD thesis at ETH Zurich. However, it is worth noting that there may be discrepancies between departments and as such you should check the requirements for your department (My thesis was under D-BAUG).\n",
        "\n",
        "I built this template based upon the `quarto-phd-thesis` template from `james-d-h`: <https://github.com/james-d-h/quarto-phd-thesis>, adding some notable features.\n",
        "\n",
        "The template is geared towards producing PDF output as I would imagine this is the most common format that theses must be submitted in.\n",
        "\n",
        "Here is the example produced by the template for you to view: [Example PDF](media/quarto-eth-phd-thesis.pdf)\n",
        "\n",
        "## ğŸ“„ Features\n",
        "\n",
        "-   The ability to add a cover page using the [`quarto_titlepages`](https://nmfs-opensci.github.io/quarto_titlepages/) extension\n",
        "\n",
        "-   Custom functions to ensure consistent formatting of all figures and tables according to user specified color palettes.\n",
        "\n",
        "-   Use of `.Rprofile` to manage package loading across chapters\n",
        "\n",
        "-   The ETH title page and a translated version of the summary into one of the Swiss national languages.\n",
        "\n",
        "-   Custom Quarto call-out boxes to display the details of published articles at the start of chapters including a visualization of author [CRediT](https://www.elsevier.com/researcher/author/policies-and-guidelines/credit-author-statement) contributions.\n",
        "\n",
        "-   Additional LaTeX formatting\n",
        "\n",
        "## ğŸš€ Getting Started\n",
        "\n",
        "### 1. Prerequisites\n",
        "\n",
        "Ensure the following are installed:\n",
        "\n",
        "-   [Quarto](https://quarto.org/)\n",
        "-   [R](https://www.r-project.org/) and [RStudio](https://posit.co/download/rstudio/)\n",
        "-   A LaTeX distribution (e.g., TinyTeX or TeX Live)\n",
        "\n",
        "### 2. Install the template\n",
        "\n",
        "Directly using Quarto from the the terminal:\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "quarto use template blenback/quarto-eth-phd-thesis\n",
        "```\n",
        "\n",
        "\n",
        "It will ask for an empty directory name where to put the files, give it a new directory name.\n",
        "\n",
        "Once you do that you can render from within the directory.\n",
        "\n",
        "Or by cloning the repository\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "git clone https://github.com/YOUR_USERNAME/quarto-eth-phd-thesis.git\n",
        "cd quarto-eth-phd-thesis\n",
        "```\n",
        "\n",
        "\n",
        "### 3. Open in RStudio\n",
        "\n",
        "Open the `quarto-eth-phd-thesis.Rproj` file in RStudio to access the full project environment.\n",
        "\n",
        "### 4. Render the Thesis\n",
        "\n",
        "From the RStudio console or terminal:\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "quarto render\n",
        "```\n",
        "\n",
        "\n",
        "## ğŸ—‚ï¸ Project Structure\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "quarto-eth-phd-thesis/\n",
        "  â”œâ”€â”€ bibliography.bib # BibTeX file for references\n",
        "  â”œâ”€â”€ _book/ # Output directory for rendered book\n",
        "  â”œâ”€â”€ chapters/ # Main content chapters^\n",
        "  |    â”œâ”€â”€ introduction\n",
        "  |    |   â”œâ”€â”€ introduction.qmd # Introduction chapter\n",
        "  |    â”œâ”€â”€ paper-01\n",
        "  |    |   â”œâ”€â”€ paper-01.qmd # First paper chapter\n",
        "  |    |   â”œâ”€â”€ paper-01-appendix.qmd # Appendix for the first paper\n",
        "  |    |   â”œâ”€â”€ paper-01-figs.R # Script to prepare figures\n",
        "  |    |   â”œâ”€â”€ figures/ # Figures for the first paper\n",
        "  |    |   â”œâ”€â”€ data/ # Data for the first paper\n",
        "  |    â”œâ”€â”€ sota\n",
        "  |    |   â”œâ”€â”€ sota.qmd # State of the art chapter\n",
        "  |    â”œâ”€â”€ structure\n",
        "  |    |   â”œâ”€â”€ structure.qmd # Structure chapter\n",
        "  |    â”œâ”€â”€ synthesis \n",
        "  |    |   â”œâ”€â”€ synthesis.qmd # Synthesis chapter\n",
        "  â”œâ”€â”€ endmatter/ # Appendices, references, curriculum Vitae\n",
        "  |    â”œâ”€â”€ appendices.qmd # Appendices\n",
        "  |    â”œâ”€â”€ references.qmd # References\n",
        "  |    â”œâ”€â”€ CV.qmd # Curriculum vitae\n",
        "  |    â”œâ”€â”€ CV.pdf # Curriculum vitae file\n",
        "  â”œâ”€â”€ _extensions/ # Custom Quarto extensions\n",
        "  â”œâ”€â”€ fonts/ # Custom fonts (e.g., FiraSans-Light.ttf)\n",
        "  â”œâ”€â”€ frontmatter/ # Cover page, , , template-partials\n",
        "  |    â”œâ”€â”€ acknowledgements.qmd # Acknowledgments\n",
        "  |    â”œâ”€â”€ images/\n",
        "  |    |   â”œâ”€â”€ cover_background.png # Background image for cover page\n",
        "  |    â”œâ”€â”€ summary_translation.qmd # summary\n",
        "  |    â”œâ”€â”€ summary_translation.qmd # Translation of summary\n",
        "  â”œâ”€â”€ index.qmd # Main Quarto document\n",
        "  â”œâ”€â”€ LaTeX_pkgs/ # Additional LaTeX packages not available through Tinytex\n",
        "  â”œâ”€â”€ LICENSE # License file\n",
        "  â”œâ”€â”€ ETH-thesis-template.cls # ETH Zurich thesis LaTeX class\n",
        "  â”œâ”€â”€ partials/\n",
        "  |    â”œâ”€â”€ title.tex\n",
        "  |    â”œâ”€â”€ before-body.tex\n",
        "  |    â”œâ”€â”€ toc.tex\n",
        "  |    â”œâ”€â”€ _coverpage.tex\n",
        "  |    â”œâ”€â”€ _author-affiliation-themes.tex\n",
        "  |    â”œâ”€â”€ titlepage-theme.lua\n",
        "  |    â”œâ”€â”€ coverpage-theme.lua\n",
        "  |    â”œâ”€â”€ _header-footer-date-themes.tex\n",
        "  |    â”œâ”€â”€ _title-themes.tex\n",
        "  |    â”œâ”€â”€ _titlepage.tex\n",
        "  |    â”œâ”€â”€ pandoc.tex\n",
        "  |    â”œâ”€â”€ header.tex\n",
        "  â”œâ”€â”€ quarto-eth-phd-thesis.Rproj # RStudio project file\n",
        "  â”œâ”€â”€ quarto-eth-phd-thesis.tex # Compiled LaTeX version (optional)\n",
        "  â”œâ”€â”€ _quarto.yml # Main Quarto project config\n",
        "  â”œâ”€â”€ README.md # This file\n",
        "  â”œâ”€â”€ .gitignore # Git ignore file\n",
        "  â”œâ”€â”€ .Rprofile # R profile for package loading\n",
        "```\n",
        "\n",
        "\n",
        "## ğŸ› ï¸ Customization\n",
        "\n",
        "### Package loading\n",
        "\n",
        "I use the `.Rprofile` to load R packages rather than specifying packages within individual `.qmd` files or `.R` scripts as the .Rprofile is called prior to rendering each file. Add any additional packages you require here.\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "#load packages\n",
        "packs<-c(\"ggplot2\", \"knitr\", \"kableExtra\", \"ggthemes\", \"stringr\")\n",
        "\n",
        "# Load required packages\n",
        "invisible(lapply(packs, require, character.only = TRUE))\n",
        "```\n",
        "\n",
        "\n",
        "### Unified table and figure theming\n",
        "\n",
        "Also in the `.Rprofile` are some functions to streamline uniform styling of figures and tables throughout your document\n",
        "\n",
        "For tables the `thesis_tbl()` function sets options for `knitr::kbl()` and `kableExtra::kable_styling()` to produce booktabs style tables, with center aligned content and bold column titles:\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "thesis_tbl <- function(x, escape, ltable = FALSE) {\n",
        "  x %>%\n",
        "    kbl(digits = 3,\n",
        "        align = \"c\",\n",
        "        booktabs = T,\n",
        "        format = \"latex\",\n",
        "        longtable = ltable,\n",
        "        escape = escape) %>%\n",
        "    kable_styling(full_width = FALSE,\n",
        "                  font_size = 10,\n",
        "                  # latex_options = c(\"hold_position\")\n",
        "                  )%>%\n",
        "    column_spec(1:ncol(x),\n",
        "                latex_valign = \"t\") %>%\n",
        "    row_spec(0, bold=TRUE) %>%\n",
        "    asis_output()\n",
        "}\n",
        "```\n",
        "\n",
        "\n",
        "An example of applying this function is included in `chapters/paper-01-qmd`:\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "\n",
        "#load csv of allocation parameter summary statistics\n",
        "Calibration_summary <- read.csv(\"chapters/paper-01/data/Validation_summary.csv\")\n",
        "\n",
        "#replace . in column names with white space\n",
        "colnames(Calibration_summary) <- str_replace_all(colnames(Calibration_summary), \"\\\\.\", \" \")\n",
        "\n",
        "#output as markdown table with Knitr::kable\n",
        "#knitr::kable(Calibration_summary, align=rep('c', ncol(LULC_agg_summary)), format = \"markdown\")\n",
        "Calibration_summary %>% \n",
        "  thesis_tbl(escape = FALSE)\n",
        "```\n",
        "\n",
        "\n",
        "For figures the function `theme_publication()` sets a custom `ggplot2` theme:\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "#' theme_publication\n",
        "#' \n",
        "#' custom ggplot2 theme to apply to all plots\n",
        "#' \n",
        "#' @param base_size numeric base font size\n",
        "#' @param base_family character base font family\n",
        "#' @return ggplot2 theme\n",
        "#' @export\n",
        "\n",
        "theme_thesis <- function(\n",
        "    base_size=14,\n",
        "    base_family=\"Fira Sans\"\n",
        ") {\n",
        "  (theme_foundation(\n",
        "    base_size=base_size,\n",
        "    base_family=base_family)+\n",
        "     theme(\n",
        "       plot.title = element_text(face = \"bold\",size = rel(1.2),hjust = 0.5),\n",
        "       text = element_text(),\n",
        "       panel.background = element_rect(colour = NA),\n",
        "       plot.background = element_rect(colour = NA),\n",
        "       panel.border = element_rect(colour = NA),\n",
        "       axis.title = element_text(face = \"bold\",size = rel(0.8)),\n",
        "       axis.title.y = element_text(angle=90,vjust =2),\n",
        "       axis.title.x = element_text(vjust = -0.2),\n",
        "       axis.text = element_text(), \n",
        "       axis.line = element_line(colour=\"black\"),\n",
        "       axis.ticks = element_line(),\n",
        "       panel.grid.major = element_blank(),\n",
        "       panel.grid.minor = element_blank(),\n",
        "       legend.key = element_rect(colour = NA),\n",
        "       legend.position = \"bottom\",\n",
        "       legend.direction = \"horizontal\",\n",
        "       legend.key.size= unit(0.2, \"cm\"),\n",
        "       legend.title = element_text(face = \"bold\",\n",
        "                                   hjust=0.5),\n",
        "       plot.margin=unit(c(10,5,5,5),\"mm\"),\n",
        "       strip.background=element_rect(colour=\"#f0f0f0\",fill=\"#f0f0f0\"),\n",
        "       strip.text = element_text(face=\"bold\")\n",
        "     )\n",
        "  )\n",
        "}\n",
        "```\n",
        "\n",
        "\n",
        "In addition the `.Rprofile` contains a series of functions for producing custom continuous and discrete color palettes with the base set of colors specified within the function `thesis_color()`:\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "thesis_color <- function(...) {\n",
        "  \n",
        "  thesis_colors <- c(\n",
        "  'Seafoam' = \"#86B4A4\", \n",
        "  'Beigetan' =\t\"#AC9E7C\",\n",
        "  'Lightgreen' =\t\"#8D9973\",\n",
        "  'Olivegreen' =\t\"#4F5838\",\n",
        "  'Forestgreen' =\t\"#2D4631\",\n",
        "  'Emeraldgreen' =\t\"#20342B\",\n",
        "  'Bluegreen' =\t\"#1C2D27\",\n",
        "  'Brown' =\t\"#413328\",\n",
        "  'Redbrown' =\t\"#4E3028\",\n",
        "  'Rust' =\t\"#8A341F\",\n",
        "  'Terracotta' =\t\"#A96524\",\n",
        "  'Orange' =\t\"#C06F2E\",\n",
        "  'Beige' =\t\"#D0A26E\",\n",
        "  'Paleorange' =\t\"#D69D68\",\n",
        "  'Bone' =\t\"#F6E3C2\",\n",
        "  'Tan' =\t\"#BDA776\",\n",
        "  'Mustard' =\t\"#B77D2B\",\n",
        "  'Ochre' =\t\"#9A792E\"\n",
        "  )\n",
        "  \n",
        "  cols <- c(...)\n",
        "  \n",
        "  if (is.null(cols))\n",
        "    return (thesis_colors)\n",
        "  \n",
        "  thesis_colors[cols]\n",
        "}\n",
        "```\n",
        "\n",
        "\n",
        "These color palettes can be applied using defined `ggplot2::scale_color_*` and `ggplot2::scale_fill_*` methods. An example of applying the `theme_thesis()` and `scale_color_thesis()` functions is provided in `chapters/paper-01/paper-01-figs.R:`\n",
        "\n",
        "\n",
        "```{bash}\n",
        "#| eval: false\n",
        "p <- ggplot(mtcars, aes(x = wt, y = mpg, color = factor(cyl))) +\n",
        "  geom_point(size = 3) +\n",
        "  labs(\n",
        "    title = \"Fuel Efficiency vs. Car Weight\",\n",
        "    x = \"Weight (1000 lbs)\",\n",
        "    y = \"Miles per Gallon\",\n",
        "    color = \"Cylinders\"\n",
        "  ) +\n",
        "  scale_color_thesis(palette = \"test_pal\")+\n",
        "  theme_thesis()\n",
        "```\n",
        "\n",
        "\n",
        "### Cover page\n",
        "\n",
        "The template allows you to add a coverpage using the [`quarto_titlepages`](https://nmfs-opensci.github.io/quarto_titlepages/) extension. The cover page YAML options are set in in `index.qmd`:\n",
        "\n",
        "\n",
        "```{yaml}\n",
        "---\n",
        "format: \n",
        "  pdf:\n",
        "    coverpage: true\n",
        "    coverpage-bg-image: \"frontmatter/images/cover_background.png\"\n",
        "    coverpage-title: \"Title\"\n",
        "    coverpage-footer: \"Subtitle\"\n",
        "    coverpage-theme:\n",
        "      title-fontfamily: \"FiraSans-Bold.ttf\"\n",
        "      title-fontsize: 24\n",
        "      title-color: mydarkgreen\n",
        "      title-align: \"right\"\n",
        "      title-bottom: \"27cm\"\n",
        "      title-width: \"20cm\"\n",
        "      title-left: \"18cm\"\n",
        "      header-style: \"none\"\n",
        "      footer-style: \"plain\"\n",
        "      footer-fontfamily: \"FiraSans-Regular.ttf\"\n",
        "      footer-bottom: \"25cm\"\n",
        "      footer-align: \"right\"\n",
        "      footer-width: \"20cm\"\n",
        "      footer-left: \"18cm\"\n",
        "      footer-fontsize: 20\n",
        "      footer-color: mydarkgreen\n",
        "      date-style: \"none\"\n",
        "      bg-image-fading: \"north\"\n",
        "      bg-image-opacity: 0.8\n",
        "---\n",
        "```\n",
        "\n",
        "\n",
        "Here I have set the title and subtitle using the extension options but you could just as easily include these manually within your background image. For the details of all the YAML options see the guide for the `quarto_titlepages` extension:\n",
        "\n",
        "### Front matter\n",
        "\n",
        "#### Translated Summary\n",
        "\n",
        "The ETH doctoral regulations stipulate that the thesis must include a translation of the summary or abstract into one of the Swiss national languages (following the English version). I have added a seperate `.qmd` file to include this and YAML key for specifying the translation of summary in `_quarto.yml`:\n",
        "\n",
        "\n",
        "```{yaml}\n",
        "---\n",
        "summarytitle: Zusammenfassung\n",
        "---\n",
        "```\n",
        "\n",
        "\n",
        "#### ETH Zurich title page\n",
        "\n",
        "To create the standard ETH title page for thesis I have adapted an [existing LaTeX template](https://github.com/tuxu/ethz-thesis/blob/master/frontbackmatter/titlepage.tex) with the relevant lines included in `ETH-thesis-template.cls`. Rather than directly editing the LaTeX I have defined YAML keys in `partials/title.tex` so that the fields can be filled directly in `_quarto.yml`:\n",
        "\n",
        "\n",
        "```{yaml}\n",
        "---\n",
        "titlepage-title: \"Your thesis title\"\n",
        "titlepage-author: \"Jane Doe\"\n",
        "summarytitle: Zusammenfassung\n",
        "degree: DOCTOR OF SCIENCES # Degree title \n",
        "degreedate: 2025 # Year of degree submission\n",
        "dissnumber: XXXX # ETH dissertation number\n",
        "citizenship: My home country # Country of citizenship\n",
        "dob: September 14, 1993 # Date of birth\n",
        "MSctitle: Environmental Policy, Science and Management # Title of MSc dgree\n",
        "MScuni: Central European University, University of Manchester, University of Lund, University of the Aegean # University/ies of MSc degree\n",
        "examiner: Prof. Dr. Dwayne Johnson # Your examiner (title and name: Prof. Dr. X)\n",
        "coexaminerone: Prof. Dr. Stevie Irwin # Your 1st co-examiner (title and name: Prof. Dr. X)\n",
        "coexaminertwo: Dr. Brian Gumble # Your 2nd co-examiner (title and name: Prof. Dr. X)\n",
        "---\n",
        "```\n",
        "\n",
        "\n",
        "Which results in the title page being rendered as:\n",
        "\n",
        "![Rendered ETH title page](media/titlepage.png){fig-align=\"center\" width=\"60%\"}\n",
        "\n",
        "### Chapters\n",
        "\n",
        "In the template I have included typical chapters such as the Introduction, State of the Art, Structure, Synthesis and an example of chapter based on a published paper (`chapters/paper-01-qmd`). Each chapter is a separate `.qmd` file and you can include/exclude them, or add additional chapters, using the `chapters` YAML key in `_quarto.yml`:\n",
        "\n",
        "\n",
        "```{yaml}\n",
        "book: \n",
        "  date: last-modified\n",
        "  chapters:\n",
        "    - index.qmd # Used to enter the cover page yaml, glossary, abbreviations, etc.\n",
        "    - chapters/introduction/introduction.qmd\n",
        "    - chapters/sota/sota.qmd\n",
        "    - chapters/structure/structure.qmd\n",
        "    - chapters/paper-01/paper-01.qmd\n",
        "    - chapters/synthesis/synthesis.qmd\n",
        "    - endmatter/references.qmd\n",
        "    - endmatter/appendices.qmd\n",
        "    - endmatter/CV.qmd\n",
        "```\n",
        "\n",
        "\n",
        "I have given each chapter a nested sub-directory in order to organize all of the content related to it but this is a personal stylistic decision. However, note that `index.qmd`, which includes the gloassary must be at the root of the project.\n",
        "\n",
        "#### Paper-based chapters\n",
        "\n",
        "For cumulative paper theses the ETH regulations state that the chapters that represent published papers should include relevant details of the original article such as a full citation, date of publication, author contributions highlights and statement regarding any chages to the content.\n",
        "\n",
        "To display this information along with some other details like links to research code and data, I use custom [Quarto Callout Blocks](https://quarto.org/docs/authoring/callouts.html) at the start of each chapters `.qmd`:\n",
        "\n",
        "![Callout block for article details](media/article-details.png){fig-align=\"center\" width=\"60%\"}\n",
        "\n",
        "The code for this is included in `chapters/paper-01/paper-01.qmd` and it uses the LaTeX [latex-credits](https://github.com/Pseudomanifold/latex-credits) package to produce the visualization of the author CRediT roles (Note this package is not available via CTAN so is included directly with the template `LaTeX_pkgs/credits.sty`).\n",
        "\n",
        "#### Updating/including figures\n",
        "\n",
        "My preferred method of preparing figures for Quarto documents is to produce and save them via dedicated R scripts rather than directly within the `.qmd` files themselves. This R script is then sourced directly at the head of the respective `.qmd` file to ensure the most up to date figures are used and the images are then included for each figure as in `paper-01.qmd`:\n",
        "\n",
        "\n",
        "```{bash}         \n",
        "#| eval: false\n",
        "#source the script that prepares all the figures\n",
        "source(\"chapters/paper-01/paper-01-figs.R\")\n",
        "\n",
        "![Dummy figure](figures/dummy_plot.png){#fig-dummy} \n",
        "```\n",
        "\n",
        "\n",
        "I do this because I find that when I have multiple figures with quite lengthy code it can make navigating the document a bit annoying. Again, this is a stylistic choice and you should feel free to include figure code directly within the `.qmd`'s.\n",
        "\n",
        "### End matter\n",
        "\n",
        "#### References\n",
        "\n",
        "`endmatter/references.qmd` places a div to ensure that all references for all chapters are placed in this section:\n",
        "\n",
        "\n",
        "``` {bash}    \n",
        "::: {#refs}\n",
        ":::\n",
        "```\n",
        "\n",
        "\n",
        "#### Appendices\n",
        "\n",
        "I have elected to have all appendices for each chapter be placed together after the reference list rather than after their respective chapters. As far I know the ETH regulations are ambiguous as to which of these options is preferred but given that I tend to have have long appendices this was preferable for me.\n",
        "\n",
        "I have also chosen to use Alpha-numeric (e.g. A.1) section numbering for the appendices which is specified at the head of `endmatter/appendices.qmd` before the .qmd files for the individual appendices for each chapter are sourced in sequence. Note: if you add additional chapters you will need to add lines to source the appendices in `endmatter/appendices.qmd`.\n",
        "\n",
        "#### Curriculum vitae\n",
        "\n",
        "The ETH regulations require that you include your curriculum vitae at the end of your thesis, `CV.qmd` uses the LaTeX command `\\includepdf[pages=-]{}` to add in your CV from a provided `.pdf`.\n",
        "\n",
        "## ğŸ“„ License\n",
        "\n",
        "This project is licensed under the terms of the LICENSE file included in the repository."
      ],
      "id": "e552f824"
    }
  ],
  "metadata": {
    "kernelspec": {
      "display_name": "Python 3",
      "language": "python",
      "name": "python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}